<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <title>Evolution of Life</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="assets/main.css">
    <link
      rel="stylesheet"
      href="https://js.arcgis.com/4.14/esri/themes/light/main.css"
    />
    <script src="https://js.arcgis.com/4.14/"></script>

    <script>
require(["esri/Map",
         "esri/views/MapView",
         "esri/layers/ImageryLayer",
         "esri/layers/support/MosaicRule",
         "esri/layers/GraphicsLayer",
         "esri/Graphic",
         "esri/geometry/Point"], 
function(Map, 
         MapView,
         ImageryLayer,
         MosaicRule,
         GraphicsLayer,
         Graphic,
         Point) {

/*START ALL USER CODE HERE*/
    /* SHARED GLOBALS SECTION */

    var gameStarted = false;
    var realTimeElapsedS = 0;
    var millionYearBCE = -1000;

    var map = new Map({
          basemap: null,
        });

    var view = new MapView({
          container: "mapViewDiv",
          map: map,
          zoom: 3,
          center: [0,0] // longitude, latitude
        });    

    /* END SHARED GLOBALS SECTION*/

    /*GAME STATS DIV SECTION*/

    //some functions here

    /* END GAME STATS DIV SECTION*/

    /* ARCGIS JS API SECTION*/
    /* PLATE TETONICS SECTION */
        var layer = new ImageryLayer({
          id: "plate-tetonics-200-mil-hs",
          url:
            "https://apl.esri.com/apl3/rest/services/Paleo_200_2_now_hs/ImageServer",
          mosaicRule: new MosaicRule({
              lockRasterIds: [41,],
              method: "lock-raster",
              ascending: false}),
        });
        var layer2 = new ImageryLayer({
          id: "plate-tetonics-200-mil",
          url:
            "https://apl.esri.com/apl3/rest/services/P_200_0/ImageServer",
          mosaicRule: new MosaicRule({
              lockRasterIds: [41,],
              method: "lock-raster",
              ascending: false}),
          opacity:0.8,
        });

       map.layers.add(layer, 0);
       map.layers.add(layer2, 1);
    var i = 41;
   intervalUpdate200MilToPresent = setInterval(function(){
        
        var layer = new ImageryLayer({
          id: "plate-tetonics-200-mil-hs",
          url:
            "https://apl.esri.com/apl3/rest/services/Paleo_200_2_now_hs/ImageServer",
          mosaicRule: new MosaicRule({
              lockRasterIds: [i,],
              method: "lock-raster",
              ascending: false}),
        });
        var layer2 = new ImageryLayer({
          id: "plate-tetonics-200-mil",
          url:
            "https://apl.esri.com/apl3/rest/services/P_200_0/ImageServer",
          mosaicRule: new MosaicRule({
              lockRasterIds: [i,],
              method: "lock-raster",
              ascending: false}),
          opacity:0.8,
        });


        map.remove(map.findLayerById("plate-tetonics-200-mil-hs"));
        map.remove(map.findLayerById("plate-tetonics-200-mil"));
        map.layers.add(layer, 0);
        map.layers.add(layer2, 1);
        i -= 1;
        if(i<0){
            console.log("Clearing 200Mil to present interval");
            clearInterval(intervalUpdate200MilToPresent);
        }
    }, 1000);

    /* END PLATE TETONICS SECTION*/
    /* LAND/SEA GRAPHICS LAYER SECTION*/

    //Add graphics code here
    let graphicsLayer = new GraphicsLayer({"id":"land-graphics-layer"});

    view.on(["click"], function(event) {
        var mapPoint = event.mapPoint;

        console.log("Point clicked    " + mapPoint.x + "," + mapPoint.y);

        var point = {
          type: "point", // autocasts as new Point()
          x: mapPoint.x,
          y: mapPoint.y,
        };

        markerSymbol = {
          type: "simple-marker", // autocasts as new SimpleMarkerSymbol()
          color: [226, 119, 40],
          outline: {
            // autocasts as new SimpleLineSymbol()
            color: [1, 1, 1],
            width: 10
          }
        };

        var pointGraphic = new Graphic({
          geometry: point,
          symbol: markerSymbol
        });

        map.findLayerById("land-graphics-layer").add(pointGraphic);
        //graphicsLayer.graphics.add(pointGraphic); 
    });


var point = {
          type: "point", // autocasts as new Point()
          x: 0,
          y: 0,
        };

markerSymbol = {
          type: "simple-marker", // autocasts as new SimpleMarkerSymbol()
          color: [226, 119, 40],
          outline: {
            // autocasts as new SimpleLineSymbol()
            color: [1, 1, 1],
            width: 10
          }
};

        var pointGraphic = new Graphic({
          geometry: point,
          symbol: markerSymbol
        });

        graphicsLayer.graphics.add(pointGraphic);

/*
    view.on("click", function(evt) {
        var screenPoint = evt.screenPoint;

        console.log("Point clicked" + str(screenPoint.x) + "," + str(screenPoint.y));

        var point = {
          type: "point", // autocasts as new Point()
          x: screenPoint.x,
          y: screenPoint.y,
        };

        markerSymbol = {
          type: "simple-marker", // autocasts as new SimpleMarkerSymbol()
          color: [226, 119, 40],
          outline: {
            // autocasts as new SimpleLineSymbol()
            color: [1, 1, 1],
            width: 10
          }
        };

        var pointGraphic = new Graphic({
          geometry: point,
          symbol: markerSymbol
        });

        layer.graphics.add(pointGraphic); 
      });
*/
    map.layers.add(graphicsLayer,30);
    /* END LAND/SEA GRAPHICS LAYER SECTION*/
    /* END ARCGIS JS API SECTION */
  });
/*END ALL USER CODE*/
    </script>
  </head>

  <body>
    <div id="container">
        
        <div id="gameStatsDiv">
            <div id="mapViewDiv"></div>
            <div id="examplePopup"><p>Hello popup!</p></div>
        </div>
    </div>
  </body>
</html>
